from django.core.management.base import BaseCommand
from django.db import transaction
from bot.models import LevelTitle


LEVEL_TITLES_DATA = {
    1: ("Человек, который видел Wi-Fi", "beginner"),
    2: ("Укротитель USB (втыкает с 3-го раза)", "beginner"),
    3: ("Нажиматель 'Согласен' не читая", "beginner"),
    4: ("Победитель замятой бумаги в принтере", "beginner"),
    5: ("Диагност методом 'постучать по корпусу'", "beginner"),
    6: ("Адепт закрытия зависших окон", "beginner"),
    7: ("Детектив 'Ой, файл куда-то исчез'", "intermediate"),
    8: ("Хранитель пароля на стикере под монитором", "intermediate"),
    9: ("Гуру создания ярлыков на рабочем столе", "intermediate"),
    10: ("Сеньор по установке Windows", "intermediate"),
    11: ("Хранитель резервных копий (которые никогда не восстанавливаются)", "intermediate"), # noqa
    12: ("Повелитель патч-кордов", "intermediate"),
    13: ("Мастер перепрошивки BIOS (со спичками)", "advanced"),
    14: ("Специалист по бесконечным обновлениям", "advanced"),
    15: ("Легенда серверной комнаты (и холодильника в ней)", "advanced"),
    16: ("Джедай кабельных трасс", "advanced"),
    17: ("Волшебник регистрации доменов", "advanced"),
    18: ("Маг диагностики методом 'выключить-включить'", "expert"),
    19: ("Архитектор виртуальных машин (которые всегда падают)", "expert"),
    20: ("Главный по облакам (и тучам проблем)", "expert"),
    21: ("Император бэкапов", "expert"),
    22: ("Верховный жрец Active Directory", "expert"),
    23: ("Ниндзя сетевой безопасности", "legend"),
    24: ("Создатель бесконечных скриптов", "legend"),
    25: ("Оракул багов и глюков", "legend"),
    26: ("Укротитель синего экрана смерти", "legend"),
    27: ("Искатель драйверов для Windows XP", "legend"),
    28: ("Властелин удлинителей и тройников", "legend"),
    29: ("Эксперт по очистке корзины", "legend"),
    30: ("Идеолог цифровой трансформации", "legend"),
    31: ("Повелитель двух мониторов", "legend"),
    32: ("Знаток отличий Java и JavaScript", "legend"),
    33: ("Вышедший из VIM (случайно)", "legend"),
    34: ("Читатель лицензионных соглашений", "legend"),
    35: ("Мастер спорта по Ctrl+C / Ctrl+V", "legend"),
    36: ("Гроза техподдержки провайдера", "legend"),
    37: ("Любитель темной темы везде", "legend"),
    38: ("Владелец механической клавиатуры (громкий)", "legend"),
    39: ("Запускатель Doom на калькуляторе", "legend"),
    40: ("Переустановщик винды соседям", "legend"),
    41: ("Свидетель аптайма 99.9%", "legend"),
    42: ("Ответственный за печеньки в офисе", "legend"),
    43: ("Знаток горячих клавиш Excel", "legend"),
    44: ("Победитель капчи с первого раза", "legend"),
    45: ("Архивариус папки 'Разобрать'", "legend"),
    46: ("Инженер по замене батареек в мышке", "legend"),
    47: ("Убийца процессов через диспетчер задач", "legend"),
    48: ("Специалист по гуглению ошибок", "legend"),
    49: ("Властелин кнопки Reset", "legend"),
    50: ("Бог серверной комнаты", "legend"),
    51: ("Админ localhost", "legend"),
    52: ("Программист на HTML", "legend"),
    53: ("Переводчик с эльфийского на Regex", "legend"),
    54: ("Укротитель Docker-контейнеров", "legend"),
    55: ("Капитан Kubernetes (теоретик)", "legend"),
    56: ("Жонглер базами данных", "legend"),
    57: ("Заклинатель SQL-инъекций", "legend"),
    58: ("Хакер из голливудских фильмов", "legend"),
    59: ("Сеньор-помидор", "legend"),
    60: ("Архитектор Матрицы (в Minecraft)", "legend"),
    61: ("Водитель мыши с RGB-подсветкой", "legend"),
    62: ("Слушатель шума кулеров", "legend"),
    63: ("Протиральщик монитора спиртом", "legend"),
    64: ("Шаман с бубном (сертифицированный)", "legend"),
    65: ("Бит-знахарь", "legend"),
    66: ("Кибер-панк 2077 года", "legend"),
    67: ("Техно-жрец", "legend"),
    68: ("Агент 404", "legend"),
    69: ("Любитель числа 42", "legend"),
    70: ("Ветеран браузерных войн", "legend"),
    71: ("Свидетель смерти Flash Player", "legend"),
    72: ("Помнитель звука модема", "legend"),
    73: ("Хранитель дискет 3.5 дюйма", "legend"),
    74: ("Владелец диска с драйверами", "legend"),
    75: ("Дефрагментатор жестких дисков", "legend"),
    76: ("Оптимизатор свободного места", "legend"),
    77: ("Счастливчик с правами root", "legend"),
    78: ("Admin-волшебник", "legend"),
    79: ("Оператор кнопки 'Сделать хорошо'", "legend"),
    80: ("Свидетель пинга < 1ms", "legend"),
    81: ("Мастер охлаждения (зимой открывает окно)", "legend"),
    82: ("Человек-оркестр (или просто разнорабочий)", "legend"),
    83: ("Владелец отвертки на все случаи жизни", "legend"),
    84: ("Многопоточный гуру", "legend"),
    85: ("Гуру кабель-менеджмента (без стяжек)", "legend"),
    86: ("Утечка памяти (в голове)", "legend"),
    87: ("Бесконечный цикл познания", "legend"),
    88: ("Рекурсивный философ", "legend"),
    89: ("Абстрактный класс человека", "legend"),
    90: ("Интерфейс будущего", "legend"),
    91: ("Техно-шаман 80 уровня", "legend"),
    92: ("Искусственный интеллект (местами)", "legend"),
    93: ("Нейросетевой странник", "legend"),
    94: ("Смотритель вечного аптайма", "legend"),
    95: ("Загрузчик сознания в облако", "legend"),
    96: ("Системный администратор Вселенной", "legend"),
    97: ("root@world:~#", "legend"),
    98: ("Повелитель времени (NTP)", "legend"),
    99: ("The One (Избранный)", "legend"),
    100: ("Бессмертный Архитектор Систем", "legend"),
}


class Command(BaseCommand):
    help = "Настройка системы уровней (микс ваших названий и автогенерации)"

    @transaction.atomic
    def handle(self, *args, **kwargs):
        exp_current = 0
        for i in range(1, 101):
            if i == 1:
                step = 0
            elif i <= 10:
                step = 30
            elif i <= 40:
                step = 50
            else:
                step = 80

            exp_current += step
            if i in LEVEL_TITLES_DATA:
                title, cat = LEVEL_TITLES_DATA[i]
            else:
                title = f"Уровень {i}"
                cat = "legend"
            LevelTitle.objects.update_or_create(
                level=i,
                defaults={
                    "title": title,
                    "category": cat,
                    "min_experience": exp_current
                }
            )
        LevelTitle.objects.filter(level__gt=100).delete()

        self.stdout.write(self.style.SUCCESS(
            "Успешно обновлено 100 уровней (включая ваши уникальные названия)!"
        ))
