{% extends "base.html" %}
{% load markdownify %}

{% block title %}–ü–æ–∏—Å–∫ –ø–æ —Å–∞–π—Ç—É{% endblock %}

{% block content %}
<section class="section">
    <div class="container">
        <h1 class="title">–†–µ–∑—É–ª—å—Ç–∞—Ç—ã –ø–æ–∏—Å–∫–∞</h1>

        <div class="box mb-6">
            <form method="GET" action="{% url 'content:global_search' %}">
                <div class="field has-addons">
                    <div class="control is-expanded">
                        <input class="input" type="search" name="q" placeholder="–ü–æ–∏—Å–∫ –ø–æ –≤—Å–µ–º—É —Å–∞–π—Ç—É..." value="{{ query }}" required>
                    </div>
                    <div class="control">
                        <button type="submit" class="button is-primary">
                            <span class="icon"><i class="fas fa-search"></i></span>
                            <span>–ù–∞–π—Ç–∏</span>
                        </button>
                    </div>
                </div>
            </form>
        </div>
        {% if query %}
            <div class="content">
                <h2 class="subtitle">–ü–æ –∑–∞–ø—Ä–æ—Å—É <strong>"{{ query }}"</strong> –Ω–∞–π–¥–µ–Ω–æ:</h2>
            </div>
            {% if tips_results %}
            <div class="box">
                <h3 class="title is-4">–ü–æ–ª–µ–∑–Ω—ã–µ –°–æ–≤–µ—Ç—ã <span class="tag is-primary">{{ tips_results|length }}</span></h3>
                <div class="columns is-multiline">
                    {% for tip in tips_results %}
                    <div class="column is-one-third">
                        <div class="card">
                            <div class="card-content">
                                <p class="title is-5">{{ tip.title }}</p>
                                <div class="content">
                                    {{ tip.content|markdownify|truncatechars_html:100 }}
                                </div>
                                <a href="{% url 'tip_detail' tip.pk %}" class="button is-primary is-outlined is-small">–ß–∏—Ç–∞—Ç—å</a>
                            </div>
                        </div>
                    </div>
                    {% endfor %}
                </div>
            </div>
            {% endif %}
            {% if news_results %}
            <div class="box">
                <h3 class="title is-4">–ù–æ–≤–æ—Å—Ç–∏ <span class="tag is-info">{{ news_results|length }}</span></h3>
                <div class="columns is-multiline">
                     {% for news in news_results %}
                    <div class="column is-one-third">
                        <div class="card">
                            <div class="card-content">
                                <p class="title is-5">{{ news.title }}</p>
                                {% if news.image %}
                                    <figure class="image is-16by9">
                                        <img src="{{ news.image.url }}" alt="{{ news.title }}">
                                    </figure>
                                {% endif %}
                                <div class="content">
                                    {{ news.content|truncatewords_html:20|safe }}
                                </div>
                                 <a href="{% url 'content:detail' news.slug %}" class="button is-info is-outlined is-small">–ß–∏—Ç–∞—Ç—å</a>
                            </div>
                        </div>
                    </div>
                    {% endfor %}
                </div>
            </div>
            {% endif %}
            {% if not tips_results and not news_results %}
            <div class="box has-text-centered">
                <p class="subtitle">üì≠ –ù–∏—á–µ–≥–æ –Ω–µ –Ω–∞–π–¥–µ–Ω–æ</p>
                <p>–ü–æ–ø—Ä–æ–±—É–π—Ç–µ –∏–∑–º–µ–Ω–∏—Ç—å –ø–æ–∏—Å–∫–æ–≤—ã–π –∑–∞–ø—Ä–æ—Å.</p>
            </div>
            {% endif %}

        {% else %}
            <div class="box has-text-centered">
                <p class="subtitle">üîç –í–≤–µ–¥–∏—Ç–µ –ø–æ–∏—Å–∫–æ–≤—ã–π –∑–∞–ø—Ä–æ—Å</p>
                <p>–ù–∞–π–¥–µ–º —á—Ç–æ-–Ω–∏–±—É–¥—å –∏–Ω—Ç–µ—Ä–µ—Å–Ω–æ–µ –¥–ª—è –≤–∞—Å!</p>
            </div>
        {% endif %}
    </div>
</section>
{% endblock %}